<html>
<head>
    <title>
        TOUR HELPER
    </title>
    <link rel="stylesheet" href="css/css.css">
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

</head>
<body>
    <div class="platform">
        <div class="top">
            <div class="logo">
                <img src="images/loetscher-transport-gmbh-logo.svg" class="firmaLogo">
            </div>
        </div>
        <div class="form">
                    <select id="tour">
                        <option value="">Select Tour</option>
                        <option value="50">50</option>
                        <option value="51">51</option>
                        <option value="52">52</option>
                        <option value="53">53</option>
                        <option value="54">54</option>
                        <option value="55">55</option>
                        <option value="56">56</option>
                        <option value="57">57</option>
                        <option value="58">58</option>
                        <option value="59">59</option>
                        <option value="61">61</option>
                        <option value="63">63</option>
                        <option value="65">65</option>
                    </select>
        </div>
        
        <div class="clientList">
            Clientes:
        </div>
        <input type="button" id="submitButton" value="Submit" class="buttonSubmit">

        <a action="./"><img class="back_arrow" src="images/back-arrow-icon.svg"></a>
        <div class="buttons">

        </div>
    </div>
</body>
<script>
let option;

$(document).ready(function() {
    $('.back_arrow').click(function() {
        location.reload(true);
    });

    $('#tour').change(function() {
        option = $(this).val();
        getClientList();
    });
});

function getClientList(){
    fetch('coords.txt')
            .then(response => response.text())
            .then(text => {
                const desiredTourId = option; // Certifique-se de que `option` contém o ID da tour selecionada

                // Regex para encontrar o bloco da tour
                const regex = new RegExp(`${desiredTourId}\\s*\\[([\\s\\S]*?)\\];`, 'm');

                const match = text.match(regex);

                if (!match) {
                    throw new Error(`Tour ID ${desiredTourId} not found.`);
                }

                let data = dataTratment(match[0]);


                // Extrair e parsear o conteúdo do array
                const arrayContent = `[${match[1]}]`;
                const allCoords = JSON.parse(arrayContent).map(coord => coord.trim());

                if (allCoords.length < 2) {
                    throw new Error("At least two coordinates required.");
                }

                // Adiciona os clientes à lista
                $('.clientList').empty();
                let clientNumber;
                allCoords.forEach(coord => {
                    $('.clientList').append(`<label><input type="checkbox" value="item${clientNumber}">${coord}</label><br>`);
                    clientNumber++;
                });

                $('.form').toggle(); // Mostra o container onde os links serão inseridos
                $('.clientList').toggle(); // Mostra a lista de clientes
                $('.buttonSubmit').toggle();






            })
            .catch(error => {
                console.error('Error:', error);
            });



}






function dataTratment(data){
        const clientsData = data.substring(data.indexOf('[') + 1, data.lastIndexOf(']')).split('","');
        clientsData = clientsData.replace(/\r\n/g, '');
        // Create a map to store the tour ID and client information
        const tourMap = {
            clients: clientsData.map(client => {
                const [name, coords] = client.split('":"');
                return { name, coords };
            })
        };

        console.log(tourMap);

        // Example: Display the map on the page
        tourMap.clients.forEach(client => {
            $('.clientList').append(`<p>${client.name} - Coordinates: ${client.coords}</p>`);
        });

}










    
</script>




</html>

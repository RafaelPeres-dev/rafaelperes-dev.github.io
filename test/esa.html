<html>
<head>
    <title>
        TOUR HELPER
    </title>
    <link rel="stylesheet" href="css/css.css">
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
</head>
<body>
    <div class="platform">
        <div class="top">
            <div class="logo">
                <!-- <img src="images/loetscher-transport-gmbh-logo.svg" class="firmaLogo"> -->
            </div>
        </div>
        <div class="form">
                    <select id="tour">
                        <option value="">Select Tour</option>
                        <option value="50">50</option>
                        <option value="51">51</option>
                        <option value="52">52</option>
                        <option value="53">53</option>
                        <option value="54">54</option>
                        <option value="55">55</option>
                        <option value="56">56</option>
                        <option value="57">57</option>
                        <option value="58">58</option>
                        <option value="59">59</option>
                        <option value="61">61</option>
                        <option value="63">63</option>
                        <option value="65">65</option>
                    </select>
        </div>
        <div class="separate">
            <div class="clientList">
                Clientes:
            </div>
            <input type="button" id="submitButton" value="Submit" class="buttonSubmit">

        </div>
        
        <a action="./"><img class="back_arrow" src="images/back-arrow-icon.svg"></a>
        <div class="buttons">
        </div>
    </div>
</body>
<script>
let option;
let dataa;
$(document).ready(function() {
    $('.back_arrow').click(function() {
        location.reload(true);
    });

    $('#tour').change(function() {
        option = $(this).val();
        getClientList();
    });

    $('#submitButton').click(function() {
        const selectedClients = [];
        $('.clientList input[type="checkbox"]:checked').each(function() {
            selectedClients.push(dataa[$(this).val().replace("item","")]);
        });

        if (selectedClients.length < 2) {
            alert("Please select at least two clients.");
            return;
        }

        getLinks(selectedClients);
        
    });
});
function getClientList(){
    fetch('coords_esa.txt')
            .then(response => response.text())
            .then(text => {
                const tours = JSON.parse(text);
                const selectedTour = tours[option];
                if (!selectedTour || selectedTour.length === 0) {
                    throw new Error("No clients found for the selected tour.");
                }
                const data = {
                    clients: selectedTour.map(client => ({
                        name: client.Name,
                        location: client.Loc
                    }))
                };
                if (data.length < 2) {
                    throw new Error("At least two coordinates required.");
                }
                $('.clientList').empty();
                let clientNumber=0;
                dataa = data.clients;
                data.clients.forEach(client => {
                    $('.clientList').append(`<label><input type="checkbox" value="item${clientNumber}">${client.name}</label><br>`);
                    clientNumber++;
                });
                $('.form').toggle();
                $('.clientList').toggle();
                $('.buttonSubmit').toggle();
            })
            .catch(error => {
                console.error('Error:', error);
            });
}


function getLinks(data){
    const origin = "My Location";
    let partNumber = 1;
    let allCoords = [];
    data.forEach(client => {
        allCoords.push(client.location);
    });
    for (let i = 0; i < allCoords.length; i += 10) {
        const slice = allCoords.slice(i, i + 11);
        const destination = slice[slice.length - 1];
        const waypoints = slice.slice(0, -1);
        const baseUrl = 'https://www.google.com/maps/dir/?api=1';
        const originParam = `origin=${encodeURIComponent(origin)}`;
        const destinationParam = `destination=${encodeURIComponent(destination)}`;
        const waypointsParam = waypoints.length
            ? `&waypoints=${encodeURIComponent(waypoints.join('|'))}`
            : '';
        const travelMode = 'travelmode=driving';
        const link = `${baseUrl}&${originParam}&${destinationParam}${waypointsParam}&${travelMode}`;
        $(".buttons").append(`<a href="${link}" target="_blank" class="myButton">Navigate Tour #${partNumber}</a>`);
        partNumber++;
    }
    
    $('.clientList').toggle();
    $('.buttonSubmit').toggle();
    $('.buttons').css('display', 'flex');
}












    
</script>




</html>
